---
title: å¾®è°ƒtesseract-ocrè¯†åˆ«IPAï¼ˆå¤±è´¥ï¼‰
tags: 
  - tesseract
categories: 
date: 2025-01-02 16:49:25
---

## å‰è¨€

å°è¯•ä½¿ç”¨ tesseract OCR æ¨¡å‹è¯†åˆ« IPA å­—ç¬¦ï¼ŒåŠ é€Ÿå½•å…¥è¿‡ç¨‹ã€‚å¤±è´¥è¿‡ç¨‹è®°å½•ã€‚ <!-- more -->

## ç¼˜èµ·

å¦‚æœä½ æœ‰çœ‹å‰é¢çš„æ–‡ç« é‚£ä½ åº”è¯¥çŸ¥é“æˆ‘ç»´æŠ¤äº†ä¸€ä¸ªæ–¹è¨€ç½‘ç«™ï¼Œå®ƒçš„åœ°å€åœ¨è¿™é‡Œã€‚è¿™ä¸ªç½‘ç«™å»ºè®¾è¿˜ç›¸å½“ä¸å®Œæ•´ï¼Œå› ä¸ºä¸€èˆ¬çš„ OCR è½¯ä»¶å®åœ¨æ˜¯æ²¡æ³•è¯†åˆ«è¿™äº›å¤å¤æ€ªæ€ªçš„ IPA å­—ç¬¦ï¼Œä¾‹å¦‚É•ã€Ã¸ã€É›ã€É™ã€É”ã€Ã£â€¦â€¦å¸¦å£°è°ƒçš„æ‹‰ä¸å­—æ¯å’Œå¸Œè…Šå­—æ¯åœ¨ä¸­æ–‡è¯­å¢ƒä¸‹å·²ç»å¤Ÿå°‘è§äº†ï¼ŒIPA å­—ç¬¦å´è¿˜åŒ…æ‹¬ä¸€äº›åå†™ã€å€’å†™çš„æ‹‰ä¸å­—æ¯ï¼Œè¿™å°±æ›´éš¾æŒ‡æœ›å®ƒä»¬äº†ã€‚æ‰€ä»¥è¿‡å»è‹¥å¹²ç¯‡å¹…çš„éŸ³æ ‡ï¼Œéƒ½æ˜¯æˆ‘ä¸€ä¸ªä¸ªæ‰‹åŠ¨æ ¡å¯¹å½•å…¥çš„ã€‚

è¿™æ ·ä½æ•ˆç‡çš„è§£å†³æ–¹æ¡ˆå¯ä¸ä¼˜é›…ã€‚å®é™…ä¸ŠéŸ³æ ‡ä¸­æ¶‰åŠçš„åªæœ‰ 5 ä¸ªæ•°å­—+çº¦ 30 æ¥ä¸ªå­—æ¯ï¼Œæ‹¢å…±åªæœ‰åä¸ªä¸åˆ°çš„ç‰¹æ®Šå­—ç¬¦ã€‚å­—ç¬¦é›†ä¹Ÿä¸ç®—å¾ˆå¤§ï¼Œä¼¼ä¹åœ¨åˆ«äººçš„ç°æœ‰æ¨¡å‹ä¸Šè¿›è¡Œä¸€äº›å¾®è°ƒæ˜¯å¯è¡Œæ–¹æ¡ˆï¼Ÿ

## å®‰è£…

ç®€å•çš„æœç´¢ä¹‹åå°±æ‰¾åˆ°äº†ä¸€ç¯‡æ–‡ç« ï¼ˆå‚è€ƒæ–‡çŒ® 1ï¼‰ä»‹ç»äº†ä¸€ä¸ªæ¨¡å‹ï¼štesseract-OCRã€‚åšä¸»ä»‹ç»åˆ° tesseract-OCR åœ¨å­—æ¯è¯†åˆ«ä¸Šä¼˜äº easyOCRï¼Œè¿™å’Œæˆ‘ä»¬çš„æƒ…å¢ƒä¸€è‡´ï¼Œå†çœ‹ GitHub æ˜Ÿæ˜Ÿä¹Ÿå¾ˆå¤šã€‚äºæ˜¯æ²¿ç€è¯¥åšä¸»ç»™çš„æ–¹æ¡ˆå‰è¿›ã€‚

å¼€å§‹å‰å…ˆä»‹ç»æˆ‘çš„ç¯å¢ƒï¼š

- Windows 11 24 H 2
- WSL 2 Ubuntu 22.04

å®‰è£… tesseract OCR å¯ä»¥ç›´æ¥é€šè¿‡ apt è¿›è¡Œ ï¼ˆå‚è€ƒæ–‡çŒ® 2ï¼‰

```bash
sudo apt install tesseract-ocr
sudo apt install libtesseract-dev
```

ç›®å‰æä¾›çš„æ˜¯ 4.0 ç‰ˆæœ¬ï¼Œé»˜è®¤ä»…å®‰è£…è‹±è¯­ã€‚

è¦å®‰è£…å…¶å®ƒè¯­è¨€ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ apt æœç´¢ï¼Œéœ€è¦æ³¨æ„æ‰€æœ‰è¯­è¨€éƒ½ä½¿ç”¨ä¸‰ä¸ªå­—æ¯è¿›è¡Œç¼©å†™ï¼ˆè€Œéå¸¸è§çš„ä¸¤ä¸ªï¼‰ã€‚ä»¥è¡¥å……å®‰è£…ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰ä¸ºä¾‹ï¼š

```bash
sudo apt install tesseract-ocr-chi-sim
```

> è¿™é‡Œæ˜¯ç¬¬ä¸€ä¸ªé”™è¯¯ï¼Œç†¬å¤œç†¬å‚»äº†ï¼Œä¸€å¼€å§‹æ‹¿çš„è‹±æ–‡åšè®­ç»ƒï¼Œåæ¥æ‰æ„è¯†åˆ°è¯è¡¨é‡Œé¢ä¸­æ–‡ä¹Ÿä¸å°‘ï¼Œæ‹¿è‹±æ–‡æ¨¡å‹åšè®­ç»ƒä¼šæŠŠæ±‰å­—å…¨è¯†åˆ«æˆä¹±ç ã€‚

## è¡¥å……ç´ æ

è¦è¡¥å……è®­ç»ƒéœ€è¦æœ‰ TIF æ ¼å¼çš„å›¾ç‰‡ï¼Œå¯ä»¥ä¸‹è½½è¿™ä¸ªå« jTessBoxEditor çš„å·¥å…·ï¼Œéœ€è¦æ³¨æ„æ˜¯ä¸‹æ–¹ä¸‹è½½åˆ—è¡¨çš„ç¬¬äºŒä¸ªï¼ˆæˆ–è€…ç¬¬ä¸€ä¸ªä¹Ÿè¡Œï¼ŸğŸ¤”ï¼‰è€Œéæœ€ä¸Šæ–¹çš„ latestã€‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªè¶Šå—è¯­ OCR çš„é™„å¸¦å°å·¥å…·ã€‚

> çœ‹å®ƒ README å¯ä»¥çŸ¥é“è¿™ä¸ªå·¥å…·æœ¬æ¥æ˜¯é’ˆå¯¹ tesseract 2. 0 X å’Œ 3.0 X å¼€å‘çš„ï¼Œåªå¯æƒœä¸æ”¯æŒ 4.0 Xã€‚

ç®€å•åœ°åœ¨ä¸€ä¸ªæ–‡æœ¬æ¡†ä¸­è¾“å…¥æˆ‘ä»¬éœ€è¦çš„ç‰¹æ®Šå­—ç¬¦ï¼Œç„¶åæˆªä¸ªå›¾ä¿å­˜ã€‚æ‰“å¼€ jTessBoxEditorï¼ŒæŠŠ png æ ¼å¼çš„å›¾ç‰‡è½¬åŒ–ä¸º tif æ ¼å¼ã€‚

> æ‰“å¼€â†’Toolsâ†’merge TIFFâ†’é€‰æ‹©æ–‡ä»¶ â†’é€‰æ‹©è¾“å‡ºè·¯å¾„å’Œè¾“å‡ºåå­—

ç„¶åè¾“å…¥å‘½ä»¤å¯¼å‡ºå¯¹åº”çš„ `.box` æ–‡ä»¶ã€‚`.box` æ–‡ä»¶è®°å½•äº†åˆ‡åˆ†å­—ç¬¦çš„æ–¹å¼ã€‚

```bash
tesseract inputfile.tif outputfile -l chi_sim --psm 7 batch.nochop makebox
```

å…¶ä¸­

- `inputfile.tif` æ˜¯å‰é¢åˆ›å»ºçš„ tif æ–‡ä»¶
- `outputfile` æ˜¯è¾“å‡ºçš„ `.box` æ–‡ä»¶çš„æ–‡ä»¶å
- `-l` æŒ‡å®šè¯­è¨€ï¼ˆè¿™é‡Œæ˜¯ä¸­æ–‡ç®€ä½“ï¼‰
- `--psm` æŒ‡å®šæ¨¡å¼ï¼Œè¿™é‡Œ 7 è¡¨ç¤ºå•è¡Œ
ä¸å¸¦ä»»ä½•å‚æ•°è¾“å‡ºå¾€å¾€éƒ½èƒ½çœ‹åˆ°è§£é‡Šä¿¡æ¯ï¼Œå› æ­¤ä¸‹é¢å°±åªæç´§è¦éƒ¨åˆ†äº†ã€‚

åŒæ ·æ‰“å¼€ `jTessBoxEditor`ï¼Œç‚¹å‡»é¡¶æ ä¸‹ä¸€æ çš„ `Box Editor`ï¼Œå³å¯ç¼–è¾‘è¡¨ç¤ºçš„å­—ç¬¦ã€æ–¹æ¡†åæ ‡é•¿å®½ç­‰ä¿¡æ¯ï¼Œæœ€åä¿å­˜ã€‚

> è¿™ä¸ªç¼–è¾‘å™¨ç”¨æ¥æœ€åæ£€æŸ¥æ‰€æœ‰çš„åæ ‡æ˜¯å¦å¯¹é½ç¡®å®æœ‰ç”¨ï¼Œä½†æ˜¯ç¼–è¾‘ä½“éªŒç›¸å½“ç³Ÿç³•ã€‚ç”±äº box æ–‡ä»¶å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªç©ºæ ¼åˆ†éš”çš„è¡¨ï¼Œä½ å¯ä»¥ç›´æ¥è®°äº‹æœ¬æ‰“å¼€åæ‹·è´åˆ° excel ä¸­è¿›è¡Œä¿®æ”¹ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªè¦ç‚¹ï¼š
>
> - æ¯è¡Œçš„ç¬¬ä¸€åˆ—è¡¨ç¤ºå¯¹åº”çš„å­—ç¬¦
> - æ¥ä¸‹æ¥çš„å››ä¸ªå­—ç¬¦è¡¨ç¤º LDTR
> - å¯ä»¥ä½¿ç”¨ Excel é€šè¿‡ LD è®¡ç®— TR å€¼ï¼Œä¿è¯å®½é«˜å¤§ä½“æ­£ç¡®

## å¾®è°ƒçš„ä¸€èˆ¬æµç¨‹

åœ¨ [tessdata_best](https://github.com/tesseract-ocr/tessdata_best) ä¸Šä¸‹è½½å¯¹åº”çš„å„è¯­è¨€æœ€ä½³æ•ˆæœæ¨¡å‹ã€‚

> apt å®‰è£…çš„æ¨¡å‹è¿›è¡Œäº†å…¶å®ƒè°ƒæ•´ï¼Œä¸èƒ½ç›´æ¥ç”¨äºè®­ç»ƒã€‚è¯¦è§å®˜æ–¹æ–‡æ¡£ã€‚

ä¸‹è½½ä¸‹æ¥çš„ `.traineddata` æ–‡ä»¶äº‹å®ä¸Šæ•´åˆäº†åŒ…æ‹¬æ¨¡å‹åœ¨å†…çš„è‹¥å¹²æ–‡ä»¶ã€‚å…¶ä¸­ï¼Œæ¨¡å‹æ˜¯ä»¥ `.lstm` ç»“å°¾çš„ï¼Œè¿™æ˜¯å› ä¸ºä» 4.0 å¼€å§‹ tesseract åŸºäº lstm æ·±åº¦å­¦ä¹ ç®—æ³•ã€‚ä»ä¸­æå–æ¨¡å‹

```bash
combine_tessdata -e chi_sim.traineddata chi_sim.lstm
```

> ğŸ¯ combine_tessdata -u filename æŸ¥çœ‹ .traineddata ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚

æ¥ç€å°†æˆ‘ä»¬çš„ tif æ–‡ä»¶è½¬åŒ–ä¸ºå¾…è®­ç»ƒé›†åˆ `.ltsmf` æ–‡ä»¶

```bash
tesseract input.tif outputfile -l chi_sim --psm 7 lstm.train
```

æ–°é”®ä¸€ä¸ªæ–‡ä»¶å†™å…¥ `.lstmf` çš„è·¯å¾„ï¼Œå‘½åå¯ä»¥å« `train_listfile`ã€‚

å†æ–°å»ºä¸€ä¸ª `.sh` æ–‡ä»¶å†™å…¥è¿è¡Œè®­ç»ƒå‘½ä»¤ï¼ˆæ³¨æ„æ›¿æ¢åœ°å€ï¼‰

```bash
lstmtraining \
--model_output=".../testOcr/output/" \
--continue_from=".../testOcr/chi_sim.lstm" \
--train_listfile=".../testOcr/chi_sim.training_files" \
--traineddata="chi_sim.traineddata" \
--debug_interval -1 \
--max_iterations 2000 \
--target_error_rate 0.01
```

ç„¶åè¿è¡Œå‘½ä»¤ã€‚

è®­ç»ƒé¡ºåˆ©ç»“æŸï¼Œå†æ–°é”®ä¸€ä¸ª `.sh` æ–‡ä»¶å†™ä¸‹è¿™ä¸²å‘½ä»¤ï¼ˆæ³¨æ„æ›¿æ¢åœ°å€ï¼‰

```bash
lstmtraining --stop_training \
--traineddata="/.../testOcr/chi_sim.traineddata" \
--continue_from="/.../testOcr/output/_checkpoint" \
--model_output="/.../testOcr/ipa.traineddata"
```

å…¶ä¸­ç¬¬ä¸€é¡¹æ˜¯æˆ‘ä»¬æ‹¿æ¥çš„åŸºç¡€æ¨¡å‹ï¼Œç¬¬äºŒé¡¹æ˜¯è®­ç»ƒè¿‡ç¨‹ä¸­ç”Ÿæˆçš„æ£€æŸ¥ç‚¹æ–‡ä»¶ï¼Œç¬¬ä¸‰é¡¹æ˜¯è¾“å‡ºæ–‡ä»¶ï¼ˆæ³¨æ„åç¼€åï¼‰ã€‚

æœ€åå°†æˆ‘ä»¬çš„æ¨¡å‹æ‹·è´åˆ° tesseract æ”¾æ¨¡å‹çš„åœ°å€å³å¯è°ƒç”¨æˆ‘ä»¬çš„æ¨¡å‹äº†ï¼ˆè¾“å…¥æ—¶çœç•¥åç¼€åï¼‰ã€‚æ³¨æ„è¿™é‡Œæˆ‘å’Œå‚è€ƒæ–‡çŒ® 1 ç»™å‡ºçš„åœ°å€å¹¶ä¸ä¸€è‡´ã€‚æˆ‘çš„æ˜¯ `/usr/share/tesseract-ocr/4.00/tessdata/`ï¼Œä¸ç¡®å®šçš„è¯ï¼Œç”¨ find æŸ¥æ‰¾ä¸€ä¸‹ä½ çš„å®‰è£…åœ°å€

```bash
find / -name eng.traineddata
```

## æˆ‘é‡åˆ°çš„å›°éš¾å’Œéº»çƒ¦

æ•´ä¸ªè¿‡ç¨‹ä¸»è¦æ˜¯çŠ¯äº†ä¸¤ä¸ªé”™è¯¯ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯æ²¡çœ‹ä¹¦~~ï¼ˆæ²¡é”™ï¼Œç½‘ç«™å»ºè®¾æ‘¸äº†å¾ˆä¹…äº†ï¼‰~~å°±ç›´æ¥æ“åˆ€ï¼Œç»“æ„æ‹¿è‹±è¯­æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œä¸­æ–‡ç›´æ¥å…¨éƒ¨å˜ä¹±ç äº†ã€‚

å¦ä¸€ä¸ªé”™è¯¯æ›´éº»çƒ¦ä¸€ç‚¹å°±æ˜¯ç›´æ¥åœ¨ `.box` æ–‡ä»¶ä¸­å†™å¯¹åº”çš„ç‰¹æ®Šå­—ç¬¦ã€‚å€’ä¸æ˜¯è¯´è¿™æ ·ä¸è¡Œï¼Œä½†æ˜¯è¦æ”¹å°±å¾—å…¨éƒ½æ”¹ï¼Œè¿˜å¾—è¦åœ¨ `.traindeddata` æ–‡ä»¶ä¸­çš„ `.unicharset` ç­‰ä¸­æ·»åŠ å¥½å¯¹åº”çš„å­—ç¬¦é›†ä¿¡æ¯æ‰è¡Œã€‚åˆ°è¿™å„¿å°±å¾—è¦å»ä»”ç»†åœ°çœ‹çœ‹æ–‡æ¡£å’Œè®ºå›è®¨è®ºäº†ã€‚éšåè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯å³ä½¿æ·»åŠ å¥½äº†å­—ç¬¦ï¼Œä¹Ÿå¾—è¦è¾“å…¥è¶³é‡çš„å­—ç¬¦è¿›è¡Œå­¦ä¹ ã€‚åˆ°è¿™å„¿é—®é¢˜å°±ä¸å¤ªå¯¹äº†ï¼šæ—¢ç„¶å¦‚æ­¤ï¼Œä¸€äº›æœ¬æ¥æˆ‘å°±ç”¨ä¸åˆ°çš„å­—ç¬¦æˆ‘ç›´æ¥åˆ æ‰é¿å…å‡ºç°è¿™ä¸ªç»“æœä¸å¥½å—ï¼Ÿç›´æ¥é‡æ–°è®­ç»ƒä¸€ä¸ªä¸å¥½å—ï¼Ÿäºæ˜¯å°±æ­¤æ‰“ä½ã€‚å…³äºä¸€äº›æˆ‘è§‰å¾—æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œå¯ä»¥çœ‹å‚è€ƒæ–‡çŒ® 3 å’Œå‚è€ƒæ–‡çŒ® 4ã€‚æ€»ä¹‹ï¼Œå¦‚æœç›´æ¥ä¿®æ”¹ `.box` æ–‡ä»¶ï¼Œé‚£ä¹ˆæœ‰ä¸‹é¢è¿™æ ·çš„é”™è¯¯

```bash
Encoding of string failed! Failure bytes:......
Can't encode transcription:...... in language ''
```

ï¼ˆæœ€åè®©å®ƒè·‘èµ·æ¥çš„è§£å†³æ–¹æ¡ˆå€’ä¹Ÿç®€å•ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å­—ç¬¦éƒ½åœ¨æ‹¼éŸ³ä¸­è¢«ç”¨åˆ°äº†ï¼Œä½¿ç”¨æ²¡æœ‰è¢«ç”¨åˆ°çš„è¿›è¡Œæ›¿æ¢å³å¯ï¼Œå¦‚ b, d, z, râ€¦â€¦ï¼‰

ç„¶è€Œï¼ŒæˆåŠŸè·‘èµ·æ¥ä¹‹åå‘ç°ï¼Œæ•´ä½“çš„è¯†åˆ«æˆåŠŸç‡ä»ç„¶ä¸å°½å¦‚äººæ„ã€‚å®é™…ä¸Šä¸ä»…æ˜¯å­—æ¯å’Œæ ‡å£°è°ƒçš„æ•°å­—å¾ˆå®¹æ˜“è¯†åˆ«ä¸å‡†ï¼Œå°±è¿æ±‰å­—ä¹Ÿæœ‰è‹¥å¹²é”™è¯¯ã€‚æ€»ä¹‹æˆåŠŸç‡ç•¥æ˜¾æ„Ÿäººã€‚åªèƒ½æš‚ä¸”æ”¾å¼ƒã€‚

## å‚è€ƒæ–‡çŒ®

1. å¦‚ä½•è®­ç»ƒä¸“å±çš„ OCR æ–‡å­—è¯†åˆ«æ¨¡å‹_easyocr è®­ç»ƒè‡ªå·±çš„æ¨¡å‹-CSDN åšå®¢: <https://blog.csdn.net/SEU_Calvin/article/details/134517629>
2. Introduction | tessdoc: <https://tesseract-ocr.github.io/tessdoc/Installation.html>
3. Canâ€™t encode transcription Â· Issue #2695 Â· tesseract-ocr/tesseract: <https://github.com/tesseract-ocr/tesseract/issues/2695>
4. Tesseract-OCR LSTM æ¨¡å‹è¨“ç·´æŒ‡å— - HackMD: <https://hackmd.io/@garyli-wd/rJ619THsO>
